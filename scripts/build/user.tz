{ parameter
    (or (or (or (pair %createUser
                   (pair (pair (pair (bool %active) (string %createdAt))
                               (pair (string %deletedAt) (string %description)))
                         (pair (pair (string %id) (string %name))
                               (pair (address %onChainId) (or %role (unit %admin) (unit %merchant)))))
                   (pair (pair (string %roleId) (option %shopId nat)) (string %updatedAt)))
                (address %getUser))
            (or (unit %getUsers) (address %removeUser)))
        (pair %updateUser
           (pair (pair (pair (bool %active) (string %createdAt))
                       (pair (string %deletedAt) (string %description)))
                 (pair (pair (string %id) (string %name))
                       (pair (address %onChainId) (or %role (unit %admin) (unit %merchant)))))
           (pair (pair (string %roleId) (option %shopId nat)) (string %updatedAt)))) ;
  storage
    (big_map
       address
       (pair (pair (pair (pair (bool %active) (string %createdAt))
                         (pair (string %deletedAt) (string %description)))
                   (pair (pair (string %id) (string %name))
                         (pair (address %onChainId) (or %role (unit %admin) (unit %merchant)))))
             (pair (pair (string %roleId) (option %shopId nat)) (string %updatedAt)))) ;
  code { LAMBDA
           address
           bool
           { PUSH address "tz1gjaF81ZRRvdzjobyfVNsAeSC6PScjfQwN" ; SWAP ; COMPARE ; EQ } ;
         SWAP ;
         UNPAIR ;
         IF_LEFT
           { IF_LEFT
               { DIG 2 ;
                 DROP ;
                 IF_LEFT
                   { PUSH address "tz1gjaF81ZRRvdzjobyfVNsAeSC6PScjfQwN" ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF { PUSH string "Only the s.c owner can create a new user record" ; FAILWITH }
                        {} ;
                     DUP ;
                     CAR ;
                     CDR ;
                     CDR ;
                     CAR ;
                     SWAP ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     NIL operation ;
                     PAIR }
                   { DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE
                       { DROP ; PUSH string "user not found" ; FAILWITH }
                       { EMPTY_BIG_MAP
                           address
                           (pair (pair (pair (pair bool string) (pair string string))
                                       (pair (pair string string) (pair address (or unit unit))))
                                 (pair (pair string (option nat)) string)) ;
                         SWAP ;
                         DIG 2 ;
                         SWAP ;
                         SOME ;
                         SWAP ;
                         UPDATE } ;
                     NIL operation ;
                     PAIR } }
               { IF_LEFT
                   { DIG 2 ; DROP 2 ; NIL operation ; PAIR }
                   { SENDER ;
                     DIG 3 ;
                     SWAP ;
                     EXEC ;
                     NOT ;
                     IF { PUSH string "Only Admin can update user details" ; FAILWITH } {} ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE
                       { SWAP ; DROP ; PUSH string "user doesn't exist" ; FAILWITH }
                       { DROP ; SWAP } ;
                     SWAP ;
                     NONE (pair (pair (pair (pair bool string) (pair string string))
                                      (pair (pair string string) (pair address (or unit unit))))
                                (pair (pair string (option nat)) string)) ;
                     SWAP ;
                     UPDATE ;
                     NIL operation ;
                     PAIR } } }
           { SENDER ;
             DIG 3 ;
             SWAP ;
             EXEC ;
             NOT ;
             IF { PUSH string "Only Admin can update user details" ; FAILWITH } {} ;
             DUP ;
             DUG 2 ;
             SOME ;
             DIG 2 ;
             CAR ;
             CDR ;
             CDR ;
             CAR ;
             GET_AND_UPDATE ;
             DROP ;
             NIL operation ;
             PAIR } } }

